geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Interaction Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Interaction Terms") +
theme_bw()
dwplot(interaction_terms,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"Days_Above_90:le_l_adi_addr1_national_prcnt" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:Days_Above_90h_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score:" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
dwplot(interaction_terms,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"Days_Above_90:le_l_adi_addr1_national_prcnt" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:Days_Above_90h_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score:" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
dwplot(interaction_terms,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:Days_Above_90h_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score:" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
dwplot(interaction_terms,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"Days_Above_90:le_l_adi_addr1_national_prcnt" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:Days_Above_90h_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score:" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
dwplot(interaction_terms,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"le_l_adi_addr1_national_prcnt:Days_Above_90" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:Days_Above_90h_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score:" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
dwplot(interaction_terms,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"le_l_adi_addr1_national_prcnt:Days_Above_90" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:mh_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score:" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
dwplot(interaction_terms,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"le_l_adi_addr1_national_prcnt:Days_Above_90" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:mh_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
dwplot(model_1,
dot_args = list(color = "blue", size = 2.5),
whisker_args = list(color="blue",size = 1)) %>%
relabel_predictors(c(
"(Intercept)" = "Intercept",
"le_l_adi_addr1_national_prcnt" = "Area Deprivation Index (%)",
"sdev_y_ders_total" = "DERS Total Score",
"mh_y_upps_pers_sum" = "UPPS-P Perseverance",
"sex" = "Sex",
"Days_Above_90" = "Days Above 90°F",
"le_l_coi_addr1_coi_total_national_score" = "COI Total Score",
"le_l_svi_addr1_total_prcntile" = "SVI Percentile",
"mh_y_upps_nurg_sum" = "UPPS-P Negative Urgency"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Dot Whisker Plot of Coefficients for Model 1") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
dwplot(interaction_terms,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"le_l_adi_addr1_national_prcnt:Days_Above_90" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:mh_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
summary(model_2)
interaction <- tidy(model_2) %>% filter(str_detect(term, ":"))
dwplot(interaction_terms,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"le_l_adi_addr1_national_prcnt:Days_Above_90" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:mh_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
dwplot(interaction,
dot_args = list(color = "blue", size = 3),
whisker_args = list(color = "blue", size = 1.5)) %>%
relabel_predictors(c(
"le_l_adi_addr1_national_prcnt:Days_Above_90" = "ADI × Heat",
"Days_Above_90:sdev_y_ders_total" = "DERS × Heat",
"Days_Above_90:mh_y_upps_pers_sum" = "Perseverance × Heat",
"Days_Above_90:sex" = "Sex × Heat",
"Days_Above_90:le_l_coi_addr1_coi_total_national_score" = "COI × Heat",
"Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
"Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
)) +
geom_vline(xintercept = 0, colour = "red", linetype = 2, size = 1) +
ggtitle("Moderation Effects with Heat Days") +
xlab("Coefficient Estimates") +
ylab("Covariates") +
theme_bw()
install.packages("psych")
install.packages("agricolae")
knitr::opts_chunk$set(echo = TRUE)
library(psych)
library(ggplot2)
# library(ggpubr)
library(car)
library(dplyr)
library(pwr)
library(effectsize)
descriptives = function(df, vars, titles){
ind = 1
out = data.frame(
mean=numeric(0),
SD=numeric(0),
SS=numeric(0),
Var=numeric(0),
Skewness=numeric(0),
kurtosis=numeric(0),
std_error=numeric(0),
N=numeric(0)
)
for (v in vars){
print(v)
var = df[v]
row_vector = c(
mean(var[!is.na(var)]),
sd(var[!is.na(var)]),
sum((mean(var[!is.na(var)])-var[!is.na(var)])^2),
var(var[!is.na(var)]),
agricolae::skewness(var[!is.na(var)]),
agricolae::kurtosis(var[!is.na(var)]),
sd(var[!is.na(var)])/sqrt(length(!is.na(var))),
length(var[!is.na(var)])
)
print(row_vector)
out[ind,] = row_vector
ind = ind+1
}
row.names(out) = titles
print(format(out,scientific=F, digits=3))
return(out)
}
#https://www.statisticshowto.com/cohens-f-statistic-definition-formulas/
# Power: https://www.r-bloggers.com/2021/05/power-analysis-in-statistics-with-r/
#    pwr.f2.test {pwr}
summary_dfs = list()
detail_dfs = list()
lm_summary_dataframe = function(label_col_1, label_col_2, label_col_3, label_col_4, lm_object){
# label_col_2, label_col_3, terms, Adjusted_R_Squared, F, df_1, df_2, p_value, residual_SE, n_terms
summary_obj = summary(lm_object)
res_data_frame = data.frame(
label_col_1 = c(label_col_1),
label_col_2 = c(label_col_2),
label_col_3 = c(label_col_3),
label_col_4 = c(label_col_4),
terms = c(toString(lm_object$terms)),
adjusted_r_squared = c(summary_obj$adj.r.squared),
f = c(summary_obj$fstatistic['value']),
df_1 = c(summary_obj$fstatistic['numdf']),
df_2 = c(summary_obj$fstatistic['dendf']),
p_value = c(pf(
summary_obj$fstatistic['value'],
summary_obj$fstatistic['numdf'],
summary_obj$fstatistic['dendf'],
lower.tail=F
)),
# residual_SE = c(), # TODO
n_terms = c(length(names(lm_object$model))-1)
)
return(res_data_frame)
}
lm_detail_dataframe = function(label_col_1, label_col_2, label_col_3, label_col_4, lm_object){
# subject_subset, variable_subset, variable_name, Estimate, Std_Error, t_value, p_value, VIF, beta, partial_eta_squared
coef_df = as.data.frame(summary(lm_object)$coefficients)
# coef_df = coef_df[c(2:length(rownames(coef_df))),]
coef_df$variable_name = rownames(coef_df)
tryCatch(
{
coef_df$VIF = c(c(NA),vif(lm_object))
},
error=function(e){
# print(e)
coef_df$VIF = c(NA)
}
)
tryCatch(
{
coef_df$Cohens_f2_partial_vec = c(NA,cohens_f_squared(lm_object)$Cohens_f2_partial)
coef_df$Eta2_partial_vec = c(NA,eta_squared(lm_object)$Eta2_partial)
coef_df$r2_partial_vec = c(NA,r2_semipartial(lm_object)$r2_semipartial)
},
error=function(e){
coef_df$Cohens_f2_partial_vec = NA
coef_df$Eta2_partial_vec = NA
coef_df$r2_partial_vec = NA
}
)
power_vec = c()
summary_obj = summary(lm_object)
for (f_val in coef_df$Cohens_f2_partial_vec){
print(f_val)
tryCatch(
{
power = pwr.f2.test(u=summary_obj$df[1]-1, v=summary_obj$df[2], f2=f_val, sig.level=0.05)$power
},
error=function(e){
power = c(NA)
}
)
power_vec = c(power_vec, power)
}
coef_df$power = unlist(power_vec, use.names = FALSE)
coef_df$label_col_1 = label_col_1
coef_df$label_col_2 = label_col_2
coef_df$label_col_3 = label_col_3
coef_df$label_col_4 = label_col_4
return(coef_df)
}
#https://www.statisticshowto.com/cohens-f-statistic-definition-formulas/
# Power: https://www.r-bloggers.com/2021/05/power-analysis-in-statistics-with-r/
#    pwr.f2.test {pwr}
summary_dfs = list()
detail_dfs = list()
lm_summary_dataframe = function(label_col_1, label_col_2, label_col_3, label_col_4, lm_object){
# label_col_2, label_col_3, terms, Adjusted_R_Squared, F, df_1, df_2, p_value, residual_SE, n_terms
summary_obj = summary(lm_object)
res_data_frame = data.frame(
label_col_1 = c(label_col_1),
label_col_2 = c(label_col_2),
label_col_3 = c(label_col_3),
label_col_4 = c(label_col_4),
terms = c(toString(lm_object$terms)),
adjusted_r_squared = c(summary_obj$adj.r.squared),
f = c(summary_obj$fstatistic['value']),
df_1 = c(summary_obj$fstatistic['numdf']),
df_2 = c(summary_obj$fstatistic['dendf']),
p_value = c(pf(
summary_obj$fstatistic['value'],
summary_obj$fstatistic['numdf'],
summary_obj$fstatistic['dendf'],
lower.tail=F
)),
# residual_SE = c(), # TODO
n_terms = c(length(names(lm_object$model))-1)
)
return(res_data_frame)
}
lm_detail_dataframe = function(label_col_1, label_col_2, label_col_3, label_col_4, lm_object){
# subject_subset, variable_subset, variable_name, Estimate, Std_Error, t_value, p_value, VIF, beta, partial_eta_squared
coef_df = as.data.frame(summary(lm_object)$coefficients)
# coef_df = coef_df[c(2:length(rownames(coef_df))),]
coef_df$variable_name = rownames(coef_df)
tryCatch(
{
coef_df$VIF = c(c(NA),vif(lm_object))
},
error=function(e){
# print(e)
coef_df$VIF = c(NA)
}
)
tryCatch(
{
coef_df$Cohens_f2_partial_vec = c(NA,cohens_f_squared(lm_object)$Cohens_f2_partial)
coef_df$Eta2_partial_vec = c(NA,eta_squared(lm_object)$Eta2_partial)
coef_df$r2_partial_vec = c(NA,r2_semipartial(lm_object)$r2_semipartial)
},
error=function(e){
coef_df$Cohens_f2_partial_vec = NA
coef_df$Eta2_partial_vec = NA
coef_df$r2_partial_vec = NA
}
)
power_vec = c()
summary_obj = summary(lm_object)
for (f_val in coef_df$Cohens_f2_partial_vec){
print(f_val)
tryCatch(
{
power = pwr.f2.test(u=summary_obj$df[1]-1, v=summary_obj$df[2], f2=f_val, sig.level=0.05)$power
},
error=function(e){
power = c(NA)
}
)
power_vec = c(power_vec, power)
}
coef_df$power = unlist(power_vec, use.names = FALSE)
coef_df$label_col_1 = label_col_1
coef_df$label_col_2 = label_col_2
coef_df$label_col_3 = label_col_3
coef_df$label_col_4 = label_col_4
return(coef_df)
}
library(psych)
library(ggplot2)
# library(ggpubr)
library(car)
library(dplyr)
library(pwr)
library(effectsize)
setwd("~/Documents/GitHub/ABCD-data-simulation")
vars <- c("mh_p_cbcl__synd__ext_sum",
"le_l_adi_addr1_national_prcnt",
"sdev_y_ders_total")
titles<- c("Externalizing", "ADI", "DERS")
desc_table <- descriptives(abcd, vars, titles)
#https://www.statisticshowto.com/cohens-f-statistic-definition-formulas/
# Power: https://www.r-bloggers.com/2021/05/power-analysis-in-statistics-with-r/
#    pwr.f2.test {pwr}
summary_dfs = list()
detail_dfs = list()
lm_summary_dataframe = function(label_col_1, label_col_2, label_col_3, label_col_4, lm_object){
# label_col_2, label_col_3, terms, Adjusted_R_Squared, F, df_1, df_2, p_value, residual_SE, n_terms
summary_obj = summary(lm_object)
res_data_frame = data.frame(
label_col_1 = c(label_col_1),
label_col_2 = c(label_col_2),
label_col_3 = c(label_col_3),
label_col_4 = c(label_col_4),
terms = c(toString(lm_object$terms)),
adjusted_r_squared = c(summary_obj$adj.r.squared),
f = c(summary_obj$fstatistic['value']),
df_1 = c(summary_obj$fstatistic['numdf']),
df_2 = c(summary_obj$fstatistic['dendf']),
p_value = c(pf(
summary_obj$fstatistic['value'],
summary_obj$fstatistic['numdf'],
summary_obj$fstatistic['dendf'],
lower.tail=F
)),
# residual_SE = c(), # TODO
n_terms = c(length(names(lm_object$model))-1)
)
return(res_data_frame)
}
lm_detail_dataframe = function(label_col_1, label_col_2, label_col_3, label_col_4, lm_object){
# subject_subset, variable_subset, variable_name, Estimate, Std_Error, t_value, p_value, VIF, beta, partial_eta_squared
coef_df = as.data.frame(summary(lm_object)$coefficients)
# coef_df = coef_df[c(2:length(rownames(coef_df))),]
coef_df$variable_name = rownames(coef_df)
tryCatch(
{
coef_df$VIF = c(c(NA),vif(lm_object))
},
error=function(e){
# print(e)
coef_df$VIF = c(NA)
}
)
tryCatch(
{
coef_df$Cohens_f2_partial_vec = c(NA,cohens_f_squared(lm_object)$Cohens_f2_partial)
coef_df$Eta2_partial_vec = c(NA,eta_squared(lm_object)$Eta2_partial)
coef_df$r2_partial_vec = c(NA,r2_semipartial(lm_object)$r2_semipartial)
},
error=function(e){
coef_df$Cohens_f2_partial_vec = NA
coef_df$Eta2_partial_vec = NA
coef_df$r2_partial_vec = NA
}
)
power_vec = c()
summary_obj = summary(lm_object)
for (f_val in coef_df$Cohens_f2_partial_vec){
print(f_val)
tryCatch(
{
power = pwr.f2.test(u=summary_obj$df[1]-1, v=summary_obj$df[2], f2=f_val, sig.level=0.05)$power
},
error=function(e){
power = c(NA)
}
)
power_vec = c(power_vec, power)
}
coef_df$power = unlist(power_vec, use.names = FALSE)
coef_df$label_col_1 = label_col_1
coef_df$label_col_2 = label_col_2
coef_df$label_col_3 = label_col_3
coef_df$label_col_4 = label_col_4
return(coef_df)
}
summary_df <- lm_summary_dataframe(
label_col_1 = "Model_1",
label_col_2 = "NoHeatModerator",
label_col_3 = "MainEffects",
label_col_4 = "Externalizing",
lm_object = model_1
)
summary_df
summary_df <- lm_summary_dataframe(
label_col_1 = "Model_1",
label_col_2 = "NoHeatModerator",
label_col_3 = "MainEffects",
label_col_4 = "Externalizing",
lm_object = model_1
)
summary_df
model_1 <- lm(mh_p_cbcl__synd__ext_sum ~ le_l_adi_addr1_national_prcnt +
sdev_y_ders_total +
mh_y_upps_pers_sum+
sex+
Days_Above_90+
le_l_coi_addr1_coi_total_national_score+
le_l_svi_addr1_total_prcntile+
mh_y_upps_nurg_sum, data = abcd)
summary_df <- lm_summary_dataframe(
label_col_1 = "Model_1",
label_col_2 = "NoHeatModerator",
label_col_3 = "MainEffects",
label_col_4 = "Externalizing",
lm_object = model_1
)
summary_df
