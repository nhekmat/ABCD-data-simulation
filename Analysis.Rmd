---
title: "ABCD Simulations for Manuscript"
output:
  pdf_document: default
  html_document: default
date: "2025-08-13"
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(lme4)
library(tidyverse)
library(ggplot2)
library(broom)
library(dplyr)
library(dotwhisker)
abcd= read.csv("simulated_data_with_days_above_90.csv")
```

### Model 1 observing effects of covariates without heat as a moderator

```{r, include=FALSE}
model_1 <- lm(mh_p_cbcl__synd__ext_sum ~ le_l_adi_addr1_national_prcnt + 
     sdev_y_ders_total +
     mh_y_upps_pers_sum+
     sex+
     Days_Above_90+
     le_l_coi_addr1_coi_total_national_score+
     le_l_svi_addr1_total_prcntile+
     mh_y_upps_nurg_sum, data = abcd)
```

```{r}
summary(model_1)
```


```{r}
dwplot(model_1,
       dot_args = list(color = "blue", size = 2.5),
       whisker_args = list(color="blue",size = 1)) %>%
  relabel_predictors(c(
    "(Intercept)" = "Intercept",
    "le_l_adi_addr1_national_prcnt" = "Area Deprivation Index (%)",
    "sdev_y_ders_total" = "DERS Total Score", 
    "mh_y_upps_pers_sum" = "UPPS-P Perseverance",
    "sex" = "Sex",
    "Days_Above_90" = "Days Above 90°F",
    "le_l_coi_addr1_coi_total_national_score" = "COI Total Score",
    "le_l_svi_addr1_total_prcntile" = "SVI Percentile",
    "mh_y_upps_nurg_sum" = "UPPS-P Negative Urgency"
  )) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2, linewidth = 1) +
  ggtitle(str_wrap("Dot Whisker Plot of Coefficients for Model 1 (No Moderator)", width =35)) +
  xlab("Coefficient Estimates") +
  ylab("Covariates") +
  theme_bw()+
  theme(plot.title = element_text(hjust = 0.5))
```

### Model 2 observing effects of covariates with heat as a moderator

```{r, include=FALSE}
model_2 <- lm(mh_p_cbcl__synd__ext_sum ~ le_l_adi_addr1_national_prcnt*Days_Above_90 + 
     sdev_y_ders_total *Days_Above_90 +
     mh_y_upps_pers_sum*Days_Above_90 +
     sex*Days_Above_90+
     le_l_coi_addr1_coi_total_national_score*Days_Above_90 +
     le_l_svi_addr1_total_prcntile*Days_Above_90 +
     mh_y_upps_nurg_sum*Days_Above_90 , data = abcd)
```

```{r}
summary(model_2)
```

```{r}
interaction <- tidy(model_2) %>% filter(str_detect(term, ":"))
dwplot(interaction,
       dot_args = list(color = "blue", size = 3),
       whisker_args = list(color = "blue", size = 1.5)) %>%
  relabel_predictors(c(
    "le_l_adi_addr1_national_prcnt:Days_Above_90" = "ADI × Heat",
    "Days_Above_90:sdev_y_ders_total" = "DERS × Heat", 
    "Days_Above_90:mh_y_upps_pers_sum" = "Perseverance × Heat",
    "Days_Above_90:sex" = "Sex × Heat",
    "Days_Above_90:le_l_coi_addr1_coi_total_national_score" = "COI × Heat",
    "Days_Above_90:le_l_svi_addr1_total_prcntile" = "SVI × Heat",
    "Days_Above_90:mh_y_upps_nurg_sum" = "Negative Urgency × Heat"
  )) +
  geom_vline(xintercept = 0, colour = "red", linetype = 2, linewidth = 1) +
  ggtitle(str_wrap("Dot Whisker Plot of Coefficients for Model 2 (With Moderator)", width = 35)) +
  xlab("Coefficient Estimates") +
  ylab("Covariates") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))
```

## Finally... The differences in $R^2$... 

```{r}
#R2
r2model1 = summary(model_1)$r.squared
r2model2 = summary(model_2)$r.squared

# adj R2
r2adjmodel1 = summary(model_1)$adj.r.squared
r2adjmodel2 = summary(model_2)$adj.r.squared

# data frame for comparison
df = data.frame(
  Models = c("Dot Whisker Plot of Coefficients for Model 2 (Moderator)"),
  R2 = c(r2model1, r2model2),
  AdjustedR2= c(r2adjmodel1, r2adjmodel2)
)
print(df)
```


## Conclusion...

 * **The model has  low adjusted $R^2$, with the moderator it increases a bit (still pretty low).**
* **With moderation effects, Social Vulnerability Index is the only significant covariate.**
 * **It may be interesting to see how this changes state by state since this model looks at things nationally.**






